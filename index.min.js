function shuffle(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),i-=1,t=e[i],e[i]=e[n],e[n]=t;return e}function clamp(e,t,n){return e<t?t:e>n?n:e}function receivedInfo(e){if(200!=e.status)return void alert("RIP!\nErreur lors de la récupération de la liste des viewers.\nCode HTTP: "+e.status);for(var t=e.data.chatters;nicknameList.firstChild;)nicknameList.removeChild(nicknameList.firstChild);shuffle(t.viewers);for(var n=0;n<t.viewers.length;n++){var i=document.createElement("li");i.classList.add("rouletteNick"),i.innerHTML=t.viewers[n],nicknameList.appendChild(i)}nicknameElems=document.getElementsByClassName("rouletteNick"),nickCount=nicknameElems.length,nickRollerSize=nickCount*nickHeight/(2*Math.PI),nickRollAngle=360*Math.random()+90,updateTransforms();for(var r=document.getElementsByTagName("head")[0],l=r.getElementsByClassName("requestTag"),n=l.length-1;n>=0;n--)r.removeChild(l[n])}function retrieveViewers(e){if(e){var t=document.createElement("script");t.classList.add("requestTag"),t.src="https://tmi.twitch.tv/group/user/"+e+"/chatters?callback=receivedInfo",document.getElementsByTagName("head")[0].appendChild(t)}}function updateRollSpeed(e){rollSpeed=rollSpeedStart-rollSpeedStart*Math.sin(e*(Math.PI/2))}function nowSec(){return Date.now()/1e3}function updateTransforms(){for(var e=0;e<nickCount;e++){var t=nickRollAngle-e*(360/nickCount),n=Math.cos(t*Math.PI/180)*nickRollerSize,i=Math.sin(t*Math.PI/180)*nickRollerSize-nickRollerSize,r=n-e*nickHeight,l=i,o=t-90,a=1-Math.abs(clamp((o+nickVisibilityAngle)%360-nickVisibilityAngle,-nickVisibilityAngle,nickVisibilityAngle))/nickVisibilityAngle;nicknameElems[e].style.transform="translateY("+r+"px)  translateZ("+l+"px) rotateX("+o+"deg)",nicknameElems[e].style.opacity=a}}function setTransformsTransitions(e){for(var t=0;t<nickCount;t++)nicknameElems[t].classList.toggle("transitionMode",e)}function loop(){currentTime=nowSec(),delta=currentTime-lastTime,lastTime=currentTime,elapsedTime=currentTime-startTime,updateRollSpeed(elapsedTime/rollDuration),nickRollAngle+=rollSpeed*delta*(360/nickCount),updateTransforms(),elapsedTime<rollDuration&&requestAnimationFrame(loop)}function roll(){rollDuration=musiqueArgent.duration,musiqueArgent.currentTime=0,musiqueArgent.volume=.05,musiqueArgent.play(),startTime=nowSec(),rollSpeedStart=Math.random()*(rollSpeedStartMax-rollSpeedStartMin)+rollSpeedStartMin,setTransformsTransitions(!1),loop()}var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},streamerNameInput=document.getElementById("streamerNameInput"),getViewersButton=document.getElementById("getViewersButton"),nicknameList=document.getElementById("rouletteList"),nicknameElems=document.getElementsByClassName("rouletteNick"),rollButton=document.getElementById("rouletteRollButton"),musiqueArgent=document.getElementById("musiqueArgent"),nickCount=nicknameElems.length,nickHeight=100,nickRollerSize=nickCount*nickHeight/(2*Math.PI),nickRollAngle=360*Math.random()+90,nickVisibilityAngle=45,rollSpeedStartMin=15,rollSpeedStartMax=85,rollSpeedStart=0,rollDuration=5,rollSpeed=0,delta,startTime=nowSec(),currentTime=startTime,lastTime=currentTime,elapsedTime=0;rollButton.addEventListener("mousedown",function(e){this.classList.toggle("down",!0)}),rollButton.addEventListener("mouseup",function(e){this.classList.toggle("down",!1)}),rollButton.addEventListener("click",function(e){roll()}),getViewersButton.addEventListener("mousedown",function(e){this.classList.toggle("down",!0)}),getViewersButton.addEventListener("mouseup",function(e){this.classList.toggle("down",!1)}),getViewersButton.addEventListener("click",function(e){retrieveViewers(streamerNameInput.value)}),nicknameList.addEventListener("wheel",function(e){return e=e||window.event,e.preventDefault(),e.returnValue=!1,nickRollAngle+=.1*(e.deltaY>0?1:-1),updateTransforms(),!1}),updateTransforms();